<!doctype html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8">
  <title>خبر زنده | Gohartaj School</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="../../assets/css/style.css">
</head>
<body>
  <header class="site-header">
    <div class="container header-inner">
      <div class="brand">
        <img src="../../imgs/profile/admin-121.png" alt="لوگو" class="brand-logo" >
        <span class="brand-name">Gohartaj School</span>
      </div>
      <nav class="top-nav">
        <a href="/" class="nav-link">خانه</a>
        <a href="/news" class="nav-link">اخبار</a>
        <a href="/news/live" class="nav-link active">خبر زنده</a>
        <a href="/login/" class="nav-btn">ورود</a>
      </nav>
    </div>
  </header>

  <main class="container app-container">
    <section class="card">
      <h3>پخش زنده</h3>
      <div id="live-wrap" class="live-wrapper"></div>
      <div id="live-meta" class="live-meta"></div>
    </section>
  </main>

  <footer class="site-footer">
    <div class="container footer-inner">
      <div>© 2025 Gohartaj School</div>
      <div><a href="/login/" class="footer-login-btn">ورود به داشبورد</a></div>
    </div>
  </footer>

  <!-- ... بالای فایل مثل قبل ... -->
<script src="../assets/js/data.js"></script>
<script src="../assets/js/common.js"></script>
<script>
  (function () {
    const form = document.getElementById("login-form");
    const err = document.getElementById("login-error");

    // اگر نشست ذخیره شده است، هدایت کن
    try {
      const existing = JSON.parse(localStorage.getItem("session"));
      if (existing && existing.role) {
        if (existing.role === "admin") location.href = "/dash/admin/";
        else if (existing.role === "student") location.href = "/dash/student";
        return;
      }
    } catch {}

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      err.textContent = "";
      const full_name = form.full_name.value.trim();
      const national_id = form.national_id.value.trim();
      const password = form.password.value;
      try {
        const dataset = await Data.getStudents();
        const admin = (dataset.admins || []).find(u => u.full_name === full_name && u.national_id === national_id && u.password === password);
        if (admin) {
          localStorage.setItem("session", JSON.stringify({ role: "admin", user: admin }));
          location.href = "/dash/admin/";
          return;
        }
        const student = (dataset.students || []).find(u => u.full_name === full_name && u.national_id === national_id && u.password === password);
        if (student) {
          localStorage.setItem("session", JSON.stringify({ role: "student", user: student }));
          location.href = "/dash/student";
          return;
        }
        err.textContent = "ورود ناموفق. اطلاعات را بررسی کنید.";
      } catch {
        err.textContent = "بارگذاری داده‌ها با خطا مواجه شد.";
      }
    });
  })();
</script>
</body>
</html>
